<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Week Details - End of Year Review</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="../css/normalize.css" rel="stylesheet" type="text/css">
  <link href="../css/webflow.css" rel="stylesheet" type="text/css">
  <link href="../css/wanderlostgalaxy.webflow.css" rel="stylesheet" type="text/css">
  <link href="../css/eoyr.css" rel="stylesheet" type="text/css">
  <style>
    .week-detail-header {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    
    .week-detail-title {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: #333;
    }
    
    .week-detail-back {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: #007bff;
      text-decoration: none;
      font-weight: 600;
      margin-bottom: 2rem;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
    
    .week-detail-back:hover {
      background: rgba(0, 123, 255, 0.1);
    }
    
    .week-detail-back svg {
      width: 20px;
      height: 20px;
      transform: rotate(180deg);
    }
    
    .week-detail-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem 4rem;
    }
    
    .week-repo-section {
      margin-bottom: 3rem;
      padding: 1.5rem;
      background: white;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }
    
    .week-repo-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid rgba(0, 0, 0, 0.1);
    }
    
    .week-repo-name {
      font-size: 1.5rem;
      font-weight: 700;
      color: #333;
    }
    
    .week-repo-link {
      color: #007bff;
      text-decoration: none;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .week-repo-link:hover {
      text-decoration: underline;
    }
    
    .week-commit-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .week-commit-item {
      padding: 1rem;
      margin-bottom: 1rem;
      background: rgba(0, 0, 0, 0.02);
      border-left: 4px solid #007bff;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
    
    .week-commit-item:hover {
      background: rgba(0, 123, 255, 0.05);
    }
    
    .week-commit-message {
      font-size: 1rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 0.5rem;
      line-height: 1.5;
    }
    
    .week-commit-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      font-size: 0.875rem;
      color: #666;
    }
    
    .week-commit-author {
      font-weight: 600;
    }
    
    .week-commit-date {
      color: #999;
    }
    
    .week-commit-link {
      color: #007bff;
      text-decoration: none;
      font-weight: 600;
    }
    
    .week-commit-link:hover {
      text-decoration: underline;
    }
    
    .week-empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: #666;
    }
    
    .week-loading {
      text-align: center;
      padding: 4rem 2rem;
    }
    
    @media (max-width: 767px) {
      .week-detail-title {
        font-size: 1.5rem;
      }
      
      .week-repo-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }
      
      .week-commit-meta {
        flex-direction: column;
        gap: 0.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="week-detail-header">
      <a href="../index.html" class="week-detail-back" aria-label="Back to week listing">
        <svg viewBox="0 0 25 25" fill="currentColor">
          <path d="M0 13.486h21.178l-9.602 9.591 1.413 1.412L23.591 13.9l.001.001L25 12.496l-.002-.002H25l-1.413-1.412h-.002L12.989.5l-1.407 1.406 9.596 9.584H0v1.996z" fill-rule="evenodd"></path>
        </svg>
        Back to Weeks
      </a>
      <h1 class="week-detail-title" id="week-detail-title">Loading...</h1>
    </div>
    
    <div class="week-detail-content" id="week-detail-content">
      <div class="week-loading">
        <div class="eoyr-loading-spinner"></div>
        <p>Loading week details...</p>
      </div>
    </div>
  </div>
  
  <script src="../js/eoyr.js"></script>
  <script>
    /**
     * Week Detail Page Script
     * Loads and displays detailed commits for a specific week
     */
    
    // Get week ID from URL (e.g., week-2025-11-25.html)
    function getWeekIdFromURL() {
      const filename = window.location.pathname.split('/').pop();
      const match = filename.match(/week-(\d{4}-\d{2}-\d{2})\.html/);
      return match ? match[1] : null;
    }
    
    // Formats a date string nicely
    function formatDate(dateString) {
      const date = new Date(dateString + 'T00:00:00');
      return date.toLocaleDateString('en-US', { 
        month: 'long', 
        day: 'numeric', 
        year: 'numeric' 
      });
    }
    
    // Formats commit date/time
    function formatCommitDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleString('en-US', {
        month: 'short',
        day: 'numeric',
        year: 'numeric',
        hour: 'numeric',
        minute: '2-digit'
      });
    }
    
    // Renders week detail content
    function renderWeekDetail(data) {
      const titleEl = document.getElementById('week-detail-title');
      const contentEl = document.getElementById('week-detail-content');
      
      if (!data || !data.repos) {
        contentEl.innerHTML = `
          <div class="week-empty-state">
            <h3>No commits found</h3>
            <p>There are no commits for this week.</p>
          </div>
        `;
        return;
      }
      
      // Set title
      const dateRange = `${formatDate(data.startDate)} - ${formatDate(data.endDate)}`;
      titleEl.textContent = `Week of ${dateRange}`;
      
      // Render repos
      const repos = Object.keys(data.repos);
      
      if (repos.length === 0) {
        contentEl.innerHTML = `
          <div class="week-empty-state">
            <h3>No commits found</h3>
            <p>There are no commits for this week.</p>
          </div>
        `;
        return;
      }
      
      contentEl.innerHTML = repos.map(repoName => {
        const commits = data.repos[repoName];
        const repoUrl = `https://github.com/core-home-web/${repoName}`;
        
        return `
          <div class="week-repo-section">
            <div class="week-repo-header">
              <div class="week-repo-name">${repoName}</div>
              <a href="${repoUrl}" target="_blank" rel="noopener noreferrer" class="week-repo-link">
                View on GitHub
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
                </svg>
              </a>
            </div>
            <ul class="week-commit-list">
              ${commits.map(commit => `
                <li class="week-commit-item">
                  <div class="week-commit-message">${escapeHtml(commit.message.split('\n')[0])}</div>
                  <div class="week-commit-meta">
                    <span class="week-commit-author">${escapeHtml(commit.author)}</span>
                    <span class="week-commit-date">${formatCommitDate(commit.date)}</span>
                    <a href="${commit.url}" target="_blank" rel="noopener noreferrer" class="week-commit-link">
                      View Commit â†’
                    </a>
                  </div>
                </li>
              `).join('')}
            </ul>
          </div>
        `;
      }).join('');
    }
    
    // Simple HTML escape
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // Load week detail
    async function loadWeekDetail() {
      const weekId = getWeekIdFromURL();
      
      if (!weekId) {
        document.getElementById('week-detail-content').innerHTML = `
          <div class="week-empty-state">
            <h3>Invalid week</h3>
            <p>Could not determine week from URL.</p>
          </div>
        `;
        return;
      }
      
      try {
        const data = await window.eoyrDashboard.fetchWeekDetail(weekId);
        renderWeekDetail(data);
      } catch (error) {
        console.error('Error loading week detail:', error);
        document.getElementById('week-detail-content').innerHTML = `
          <div class="week-empty-state">
            <h3>Error loading week details</h3>
            <p>${error.message || 'Failed to load week data. Please try again.'}</p>
            <button class="eoyr-filter-button" onclick="location.reload()">Retry</button>
          </div>
        `;
      }
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadWeekDetail);
    } else {
      loadWeekDetail();
    }
  </script>
</body>
</html>

